PushGateway API

Все взаимодействие с PushGateway производится через API. Он, конечно, имеет UI, но его можно использовать для просмотра и очистки данных.

Все labels, указанные в URL, используются в качестве ключа для группировки метрик.
Структура URL

Имя задачи и labels передаются как часть URL. Все запросы начинаются с /metrics

/metrics/job/<JOB_NAME>{/<LABEL_NAME>/<LABEL_VALUE>}

<JOB_NAME> - используется как значение label job и является обязательным.

Далее идут пары <LABEL_NAME>/<LABEL_VALUE>, где <LABEL_NAME> это имя label, а <LABEL_VALUE> значение этого label. Их количество не ограничено.

Например, метрика: slurm_pushgateway_test{job="test_job",instance="localhost", edu="slurm"} будет преобразована в:

/metrics/job/test_job/instance/localhost/edu/slurm/

NB! Если label содержит "/", пробел или русские символы, то его необходимо закодировать в base64. А при запросе указать @base64. Данная ключевое слово помогает PushGateway понять, что контент закодирован.

Например, для передачи в качестве значения для label path, /var/tmp запрос будет выглядеть так:

/metrics/job/test_job/path@base64/L3Zhci90bXA

Метод PUT

PUT запрос замещает все метрики для группы. Код ответа может быть 200 – в случае успешного обновления, и 400 – в случае ошибки.

Если запрос выполняется с пустым body, то это приводит к удалению всех метрик для группы. При этом push_times_seconds не обновляется.

push_times_seconds – метка времени последнего удачного POST или PUT запроса.

push_failure_time_seconds – метка времени последнего неудачного POST или PUT запроса.
Метод POST

POST запрос работает аналогично PUT, но обновляет значение только для метрик, которые присутствуют в запросе.

Если запрос выполняется с пустым body, то push_times_seconds обновляется, а изменение ранее переданных метрик не производится.
Метод DELETE

DELETE запрос используется для удаления метрик из PushGateway. Удаляется вся группа метрик. Тело запроса всегда должно быть пустым.

При успешном выполнении код ответа всегда будет 202.