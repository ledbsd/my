Функции для сounter

    topk 

Функция возвращает k элементов  с максимальным значением. Функция: topk(5, http_requests_total) вернет 5 значений для метрики http_requests_total для которых будут максимальные значения.

    bottomk

Функция возвращает k элементов  с минимальным значением. Функция: bottomk(5, http_requests_total) вернет 5 значений для метрики http_requests_total для которых будут минимальные значения.

NB! topk и bottomk при использовании с by и without, в отличие от остальных операторов агрегации, возвращают полный набор метрик, а by и without используется только для группировки значений.

    rate

Функция вычисляет среднюю скорость увеличения временного ряда в секунду. При сбросе счетчика в 0, данные корректируются, чтобы это не влияло на конечный результат.

    increase

Функция вычисляет увеличение во временном ряду в диапазоне вектора. Формула для расчета: rate(x_total [time]) * time

    irate

Функция вычисляет мгновенную скорость увеличения временного ряда в векторе диапазона. Он похож на rate, но для анализа использует последние две выборки вектора.

    resets

Функция вычисляет число сбросов счетчика в предоставленном временном диапазоне в качестве мгновенного вектора. Любое уменьшение значения между двумя последовательными выборками интерпретируется как сброс счетчика.
Функции для Histograms

    histogram_quantile

Функция группирует значения по bucket, а затем вычисляет φ-квантиль (0 ≤ φ ≤ 1). Функция rate() позволяет произвести расчет за период времени. Функция:

histogram_quantile(0.90,rate(prometheus_tsdb_compaction_duration_seconds_bucket[1d]))

рассчитывает 0,9 квантиль для prometheus_tsdb_compaction_duration_seconds_bucket за предыдущий день.

Значения за пределами 0 ≤ φ ≤ 1 не имеют смысла и равняются бесконечности.

Предпочтительным способом расчета квантили является использование Summary, но некоторые exporters предоставляют данные в виде Histogram. В этом случае использование функции histogram_quantile является обоснованным.
Функции для Gauges

    changes

Функция позволяет подсчитать, сколько раз временной ряд изменил свое значение. Данная функция удобна, например, для подсчета количества перезапусков процесса за период времени.

    deriv

Функция позволяет узнать скорость изменения временного ряда в секунду за период времени. Эта функция похожа на x - x offset 1h, но на результат данного запроса могут повлиять локальные выбросы, а deriv для расчета значения использует функцию простой линейной регрессии, что делает ее результат точнее и устойчивее к локальным выбросам.

    predict_linear

Функция возвращает предсказание о значении временного ряда через n секунд. Предсказание вычисляется с помощью функции простой линейной регрессии.

    delta

Функция похожа на increase и возвращает изменение временного ряда за период времени, но без учета сбросов. Данная функция является чувствительной к локальным выбросам и использовать ее стоит с осторожностью.

    idelta

Функция возвращает разницу между последними 2-мя значениями во временном ряду.

    holt_winters

Функция реализует двойное экспоненциальное сглаживание Holt-Winters. Это полезно для очистки данных от локальных выбросов и оценки трендов изменения метрики. В качестве входных параметров функция принимает временной ряд, коэффициент сглаживания и коэффициент важности более старых данных по отношению к более новым.