Настройка Rules

Общие сведения

Rules описываются в отдельном конфигурационном файле. Формат - yml. Prometheus поддерживает загрузку правил из нескольких файлов. Rules загружаются только при отсутствии ошибок во всех Rules. Для проверки на наличие синтаксических ошибок можно использовать утилиту promtool.

promtool check rules /path/to/example.rules.yml

NB! На файлы с правилами не выставляется inotify, поэтому после любого изменения правил требуется, как минимум, выполнять reload – для того, чтобы Prometheus применил изменения.

Чтобы загрузить правила в Prometheus, список файлов с Rules необходимо взять в основном конфигурационном файле Prometheus.

rule_files:
  - "rules_file1.yml"
  - "rules_file2.yml"
  - "rules/*.yml"

В rules_files задается список, также можно задавать имена файлов по маске.

Синтаксис rules файла

Все правила объединяются в группы. Правила внутри группы запускаются последовательно, с регулярными интервалами. Разные группы выполняются в разное время, чтобы снизить нагрузку на Prometheus.

groups:
  - name: example
    interval: 10s
    rules:
    - record: job:process_cpu_seconds:rate5m
      expr: sum without(instance)(rate(process_cpu_seconds_total[5m]))
      labels:
        slurm_edu: exmple_rules
   

name – это имя для группы правил. Оно должно быть уникальным и является обязательным.

interval – интервал, с которым будет производиться выполнение и сохранение правил в группе. Не является обязательным. По умолчанию равен global.evaluation_interval.

record – имя, по которому результат будет доступен при извлечении данных. Рекомендации по составлению будут приведены в следующем шаге. Является обязательным.

 expr – выражение, которое используется для вычисления. Является обязательным.

labels – список меток, которые будут добавлены к вектору. Не является обязательным.